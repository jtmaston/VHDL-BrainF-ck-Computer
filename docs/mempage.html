<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Brainf*ck computer: Memory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="override.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bflogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Brainf*ck computer<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">A silly little BF-running computer based on the Lattice ECP5 FPGA</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('mempage.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Memory</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Decoding memories is hard!</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Architecture</h2>
<p>For both <a class="el" href="class_r_a_m.html">RAM</a> and <a class="el" href="class_r_o_m.html">ROM</a>, I've devised a system. Basically, a memory module is formed of two main components:</p><ol type="1">
<li>An address decoder / cell router: a component that takes an address (an 8-bit value) and breaks it down into individual lines, which act as chip select lines for the...</li>
<li>Memory cells: these represent individual 8-bit wide cells, that can be either read-write (in the case of <a class="el" href="class_r_a_m.html">RAM</a>), or readonly. This means that the memory architecture will be composed of:<ol type="a">
<li>An 8-bit address bus (I use an integer for easier routing into the decoder)</li>
<li>An 256-bit wide selector bus (the maximum number of cells that can fit in the 8 bit bus)</li>
<li>An 8-bit data bus (still debating whether to also convert this into an integer, currently represented as a bus)</li>
<li>A 'transaction' signal, that tells the memory block when to execute a command</li>
<li>An enable signal, in order to be able to release the data lines (i.e. so we can attach multiple memory units onto the same bus)</li>
</ol>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md3"></a>
Decoder</h2>
<p>As for the decoder, this seems like the easy part. A simple shift register should do, just to yoink the data on a clock pulse? Well, not quite. I'm still trying to wrap my head around it, but, briefly, here's the deal: I went for a time-based approach. Everything in this design should be clocked, each pulse (i.e. transition from high to low) being a time quanta. We can therefore describe the "performance" of each element in terms of "time quantas" (aka TQ's).</p>
<p>The first design was a one-TQ one, one that, as soon as it received a pulse, it shifted the data onto the lines. Well... then I hit a snag:</p>
<p><img src="Decoder1TQ.png" alt="Decoder1TQ.png" class="inline"/></p>
<p>The answer lies in... signal propagation. You simply cannot shift data onto a bus, then process it, on the same TQ. So, I fixed it by extending the decoder to run on 2 TQ's...</p>
<div class="image">
<img src="Decoder2TQ.png" alt=""/>
<div class="caption">
Decoder2TQ.png</div></div>
    <p>Well, well! This looks better, but... Interestingly, it seems that... It's skipping the odd numbers? It was at this point that I started testing using testbenches (up until now I had loaded the signal into ModelSIM and generated the signals manualy (smart, I know)), and started to notice... the approach was more than flawed... it was dangerously so.</p>
<p>I realized I would need a new system. Especially when loading <a class="el" href="class_r_a_m.html">RAM</a> (which supports both read and write), I'd run into a limit: number of edges of a pulse. If I were to, say, set the address decoder on the rising edge, then have the ram return the data on the falling edge, it would work:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">TQ 1   </th><th class="markdownTableHeadNone">TQ 2    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="class_r_a_m.html">RAM</a> CS set   </td><td class="markdownTableBodyNone"><a class="el" href="class_r_a_m.html">RAM</a> cell puts data onto the bus   </td></tr>
</table>
<p>But what about writing? We'll assume some other source (the ALU, for example) writes data to a <a class="el" href="class_r_a_m.html">RAM</a> cell. We'll call this our stimulus.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">TQ 1   </th><th class="markdownTableHeadNone">TQ 2    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="class_r_a_m.html">RAM</a> CS set   </td><td class="markdownTableBodyNone">Stimulus writes data to bus / <a class="el" href="class_r_a_m.html">RAM</a> cell reads data   </td></tr>
</table>
<p>Oof. We're back to square one, with synchronization at the forefront of the problem. The stimulus would have to write the address and data lines during TQ0 (some time before TQ1), then the cell would route the address during TQ1 and would perform the action needed. But in reverse? The cell would have to decode the address during TQ1, then shift data out during TQ2, at which point the stimulus would have to process the data, which would once again result in an overlap.</p>
<p>In the end, I settled for a 3-TQ design. This would at least eliminate some of the headache. I'll test it later to see if I can make it more efficient.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">TQ 1   </th><th class="markdownTableHeadNone">TQ 2   </th><th class="markdownTableHeadNone">TQ3    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stimulus sets address   </td><td class="markdownTableBodyNone">Address is decoded -&gt; sync (ready) pulse emitted   </td><td class="markdownTableBodyNone"><a class="el" href="class_r_a_m.html">RAM</a> chip reads data / writes data   </td></tr>
</table>
<div class="image">
<img src="Decoder3TQ.png" alt=""/>
<div class="caption">
Decoder3TQ.png</div></div>
    <p>Not only does this signal look much better (it actually increments properly), you notice a "parallel" clock signal, pulsing on the "ready" line, which can be used to... [drumroll, please!] provide a clock cycle for a downstream RA(O)M cell, one where we are <em>sure</em> that the routing is complete and data is ready. Huzzah, the decoder is ready!</p>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="archpage.html">Architecture</a>   </td><td class="markdownTableBodyRight"></td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.1 </li>
  </ul>
</div>
</body>
</html>
